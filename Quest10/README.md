# Quest 10. 인증의 이해

## Introduction

- 이번 퀘스트에서는 웹에서의 인증에 관해 알아보겠습니다.

## Topics

- Cookie
- Session
- JWT

## Resources

- [MDN - HTTP 쿠키](https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies)
- [Cookies and Sessions](https://web.stanford.edu/~ouster/cgi-bin/cs142-fall10/lecture.php?topic=cookie)
- [JWT](https://jwt.io/)

## Checklist

- 쿠키란 무엇일까요?
  쿠키(Cookie)는 웹 브라우저에서 웹사이트를 방문할 때 생성되는 작은 텍스트 파일이다. 서버에서 클라이언트(웹 브라우저)로 전송되어 저장되며, 이후 클라이언트에서 서버로 요청을 보낼 때마다 쿠키는 함께 전송된다.
  쿠키는 보통 사용자가 로그인한 상태를 유지하거나, 쇼핑 카트의 정보를 유지하는 등의 기능을 수행하기 위해 사용된다. 예를 들어, 사용자가 로그인을 하면 서버에서 생성된 쿠키를 웹 브라우저에 전송하고, 이후 사용자가 다른 페이지로 이동하거나 새로고침을 하더라도 로그인 상태가 유지될 수 있다. 쿠키는 브라우저에서 제어할 수 있으며, 보안 등의 이유로 브라우저 측에서 일정 기간이 지나면 삭제되거나 만료될 수 있다.

  - 쿠키는 어떤 식으로 동작하나요?
    쿠키는 웹 브라우저와 서버 간의 상호작용에서 정보를 주고받을 수 있도록 해주는 작은 데이터 조각이다. 쿠키는 일반적으로 서버가 클라이언트(브라우저)에게 정보를 보내고, 그 정보를 클라이언트가 나중에 동일한 서버에 요청할 때 함께 보내서 인증, 사용자 상태, 선호도 등을 기억하도록한다.
    웹 브라우저는 서버로부터 응답을 받을 때 쿠키를 저장하고, 나중에 동일한 서버로 요청을 보낼 때 쿠키를 함께 보내게 된다. 쿠키는 이름, 값, 만료 날짜 및 경로 등의 정보를 포함하고 있다. 만료 날짜를 설정하면, 그 날짜가 지나면 쿠키가 삭제한다.
    쿠키는 보안과 개인정보보호에 관한 이슈를 야기하기도 한다. 예를 들어, 쿠키를 이용하면 사용자의 개인정보를 추적하거나, 클라이언트가 아닌 다른 사용자가 해당 쿠키를 사용하여 인증된 사용자처럼 서버와 통신할 수 있다. 따라서 쿠키를 사용할 때에는 보안과 개인정보보호 측면에서 주의해야한다.

  - 쿠키는 어떤 식으로 서버와 클라이언트 사이에 정보를 주고받나요?
    쿠키는 일반적으로 HTTP 요청 헤더와 응답 헤더를 통해 서버와 클라이언트 사이에서 주고받는다.

    1. 서버에서 쿠키를 생성하고 HTTP 응답 헤더의 `Set-Cookie` 헤더를 사용하여 클라이언트에게 쿠키를 전송한다. 이 헤더는 클라이언트에게 새로운 쿠키를 생성하도록 지시하며, 쿠키의 이름, 값, 만료일 및 경로 등의 정보를 포함한다.
    2. 이후 클라이언트는 요청을 보낼 때마다 해당 도메인으로 설정된 모든 쿠키를 HTTP 요청 헤더의 `Cookie` 헤더에 포함하여 서버에 전송한다.
    3. 서버는 `Cookie` 헤더에서 쿠키를 읽어 사용한다.

    이렇게 함으로써, 클라이언트는 이전 요청과 동일한 도메인에 대해 새로운 요청을 보낼 때마다 이전 요청에서 생성된 쿠키를 사용할 수 있다. 쿠키는 보안 및 개인 정보 보호 문제가 있을 수 있으므로, 적절한 보안 대책을 적용하여 사용해야한다.

- 웹 어플리케이션의 세션이란 무엇일까요?
  웹 어플리케이션에서 세션이란, 클라이언트와 서버 간에 지속적인 상태 정보를 유지하기 위한 기술이다. 세션을 사용하면, 클라이언트의 요청과 서버의 응답이 이루어지는 동안 일시적으로 상태 정보를 저장하고 유지할 수 있다.
  일반적으로, 세션은 클라이언트가 로그인한 후 서버가 클라이언트에게 부여한 고유한 식별자를 사용하여 관리한다. 이 식별자를 사용하면 서버는 클라이언트의 이전 요청과 상태 정보를 유지할 수 있다. 이를 통해 클라이언트는 요청과 응답 과정에서 계속해서 로그인 상태를 유지하거나, 이전에 수행한 작업과 상태 정보를 다음 요청에서 사용할 수 있다.
  세션은 서버 측에서 관리되며, 일반적으로 메모리나 데이터베이스에 저장한다. 클라이언트와 서버 간에 세션을 유지하기 위해 쿠키를 사용하기도 한다. 쿠키를 사용하여 클라이언트의 브라우저에 저장된 세션 ID를 이용하여, 서버는 클라이언트의 세션 정보를 식별하고 유지할 수 있다.

  - 세션의 ID와 내용은 각각 어디에 저장되고 어떻게 서버와 교환되나요?
    세션 ID와 내용은 서버 측에 저장되며, 보통 서버의 파일 시스템이나 데이터베이스에 저장한다.
    세션 ID는 보통 쿠키를 통해 클라이언트에게 전달되며, 클라이언트가 서버에 요청을 보낼 때마다 쿠키에 포함된 세션 ID가 함께 전달한다. 서버는 세션 ID를 사용하여 저장된 세션 데이터를 식별하고 해당 세션 데이터를 클라이언트에게 전달한다.
    따라서, 클라이언트가 세션 ID를 포함한 요청을 보내면, 서버는 해당 세션 ID를 사용하여 서버에 저장된 해당 세션 데이터를 찾아서 처리한다. 이렇게 함으로써, 서버는 클라이언트와의 상태를 유지하고, 세션 데이터를 공유하여 클라이언트의 요청을 처리할 수 있다.

- JWT란 무엇인가요?
  JWT( JSON Web Token)는 웹 표준으로, 데이터 전송 시 클라이언트와 서버 간 정보를 JSON 객체로 안전하게 전송하기 위한 방법 중 하나다.
  JWT는 토큰 기반 인증 방식으로, 사용자가 로그인하면 서버에서 해당 사용자에 대한 JWT를 생성하고 클라이언트에게 전송한다. 클라이언트는 이후 서버에 요청을 할 때마다 JWT를 포함시켜 전송하며, 서버는 해당 JWT를 검증하여 사용자 인증 여부를 판단한다.
  JWT는 보통 세 부분으로 구성된다. 첫 번째는 헤더(Header)이다. 헤더는 토큰의 타입과 해싱 알고리즘 정보를 담고 있다. 두 번째는 페이로드(Payload)이다. 페이로드는 토큰에 담길 정보들을 JSON 형식으로 담고 있다. 세 번째는 서명(Signature)이다. 서명은 토큰의 유효성을 검증하기 위한 암호화된 문자열로, 헤더와 페이로드를 합친 후 서버에서 비밀키로 암호화하여 생성한다.
  JWT는 쿠키와 달리 서버에서 상태를 관리하지 않으며, 클라이언트에 저장되기 때문에 서버의 확장성을 높일 수 있다. 또한, JWT에는 정보를 암호화하여 저장할 수 있으므로 보안적인 측면에서도 유리하다.

  - JWT 토큰은 어디에 저장되고 어떻게 서버와 교환되나요?
    JWT 토큰은 일반적으로 클라이언트 측에서 `localStorage` 나 `sessionStorage` 같은 웹 스토리지에 저장한다. 서버와의 교환은 HTTP 요청 헤더에 토큰 값을 담아 보내는 방식으로 이루어진다. 일반적으로 `Authorization` 헤더를 사용하여 JWT 토큰을 보낸다. 예를 들어, `Authorization: Bearer {JWT 토큰 값}`과 같은 형태로 보낸다. 서버는 이 헤더에서 JWT 토큰 값을 추출하여 인증과 권한 부여를 수행한다.
    또한, JWT 토큰은 서명되기 때문에, 클라이언트에서 JWT 토큰을 수정하면 서버에서 검증할 때 서명이 일치하지 않기 때문에 검증이 실패한다. 이로 인해, 클라이언트는 JWT 토큰에 대한 조작을 막을 수 있으며, 서버에서는 JWT 토큰을 신뢰하고 사용할 수 있다.

- 세션에 비해 JWT가 가지는 장점은 무엇인가요? 또 JWT에 비해 세션이 가지는 장점은 무엇인가요?
  JWT와 세션은 모두 인증과 인가를 위한 매커니즘으로 사용되지만 각각의 장단점이 있다.

  JWT의 장점:

  - 서버에서 인증 상태를 관리하지 않아도 되기 때문에 서버 확장성이 높아진다.
  - 서버의 상태를 기억하고 있을 필요가 없으므로, 서버와 클라이언트 간 독립적이기 때문에 마이크로서비스 아키텍처와 같은 경우 JWT를 사용하기 적합하다.
  - 토큰 자체에 정보가 담겨있으므로, 불필요한 데이터베이스 조회를 줄일 수 있어서 성능이 더 우수하다.

  세션의 장점:

  - JWT는 토큰을 발급할 때 토큰에 대한 정보를 모두 담아 보내므로, 토큰이 조작될 가능성이 있다. 반면, 세션은 서버에서 정보를 관리하므로 토큰의 내용에 대한 신뢰성이 높다.
  - 브라우저의 쿠키에 세션 ID만 저장되기 때문에, 보안적으로 민감한 정보가 클라이언트에 노출되지 않다.
  - 세션은 만료 시간을 설정하여 토큰을 무효화시키는 것이 가능하다. 따라서 만약 토큰이 유출된 경우에는 서버 측에서 해당 세션 ID를 무효화시키는 등의 대응이 가능하다.

  물론 JWT와 세션 모두 장단점이 존재하며 사용 시 고려해야 할 사항이 많다. 따라서 실제 상황에서는 보안과 성능, 서비스의 성격에 맞는 방식을 선택하여 사용하는 것이 중요하다.

## Quest

- 이번에는 메모장 시스템에 로그인 기능을 넣고자 합니다.
  - 사용자는 딱 세 명만 존재한다고 가정하고, 아이디와 비밀번호, 사용자의 닉네임은 하드코딩해도 무방합니다.
  - 로그인했을 때 해당 사용자가 이전에 작업했던 탭들과 마지막으로 활성화된 탭 등의 상태가 로딩 되어야 합니다.
  - 세션을 이용한 버전과, JWT를 이용한 버전 두 가지를 만들어 보세요!
    - 세션을 이용할 경우 세션은 서버의 메모리나 파일에 저장하면 됩니다.

## Advanced

- Web Authentication API(WebAuthn)은 무엇인가요?
